<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="GolangGo modules使用步骤：https:&#x2F;&#x2F;blog.csdn.net&#x2F;fly910905&#x2F;article&#x2F;details&#x2F;104297446#Go%20modules%E4%BD%BF%E7%94%A8%E6%AD%A5%E9%AA%A4%EF%BC%9A go mod initgo mod tidygo mod verifygo mod vendor golang如何将inter">
<meta property="og:type" content="article">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/2021/06/28/Doing/%E5%B7%A5%E4%BD%9C%E6%97%A5%E5%BF%97/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="GolangGo modules使用步骤：https:&#x2F;&#x2F;blog.csdn.net&#x2F;fly910905&#x2F;article&#x2F;details&#x2F;104297446#Go%20modules%E4%BD%BF%E7%94%A8%E6%AD%A5%E9%AA%A4%EF%BC%9A go mod initgo mod tidygo mod verifygo mod vendor golang如何将inter">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2021-06-28T03:26:11.108Z">
<meta property="article:modified_time" content="2021-06-02T01:40:21.556Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-Doing/工作日志" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/06/28/Doing/%E5%B7%A5%E4%BD%9C%E6%97%A5%E5%BF%97/" class="article-date">
  <time class="dt-published" datetime="2021-06-28T03:26:11.108Z" itemprop="datePublished">2021-06-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Golang"><a href="#Golang" class="headerlink" title="Golang"></a>Golang</h1><h2 id="Go-modules使用步骤："><a href="#Go-modules使用步骤：" class="headerlink" title="Go modules使用步骤："></a>Go modules使用步骤：</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/fly910905/article/details/104297446#Go%20modules%E4%BD%BF%E7%94%A8%E6%AD%A5%E9%AA%A4%EF%BC%9A">https://blog.csdn.net/fly910905/article/details/104297446#Go%20modules%E4%BD%BF%E7%94%A8%E6%AD%A5%E9%AA%A4%EF%BC%9A</a></p>
<p>go mod init<br>go mod tidy<br>go mod verify<br>go mod vendor</p>
<h1 id="golang如何将interface转为int-string-slice-struct等类型"><a href="#golang如何将interface转为int-string-slice-struct等类型" class="headerlink" title="golang如何将interface转为int, string, slice, struct等类型"></a>golang如何将interface转为int, string, slice, struct等类型</h1><p><a target="_blank" rel="noopener" href="http://www.fidding.me/article/99">http://www.fidding.me/article/99</a></p>
<h1 id="Spring-Boot"><a href="#Spring-Boot" class="headerlink" title="Spring Boot"></a>Spring Boot</h1><ul>
<li><p>＠EnableAutoConfiguration<br>通过＠EnableAutoConfiguration 启用 Spring 应用程序上下文的自动配 ，这个注解会导人一个 EnableAutoConfigurationlmportSelector 的类，而 AutoConfigurationlmportSelector这个类会去读取一个 spring.factories下 key 为 EnableAutoConfiguration 对应的类全限定名的值。</p>
</li>
<li><p>exclude 一个AutoConfiguration<br>在<code>application.properties</code>文件加入下面这行。<br><code>spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration</code></p>
</li>
</ul>
<p>或者<br><code>@EnableAutoConfiguration(exclude=SecurityAutoConfiguration.class)</code><br>@SpringBootApplication 的exclude 不起作用。</p>
<ul>
<li>@EnableConfigurationProperties</li>
</ul>
<h1 id="Yapi安装启动"><a href="#Yapi安装启动" class="headerlink" title="Yapi安装启动"></a>Yapi安装启动</h1><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mkdir yapi</span><br><span class="line">cd yapi</span><br><span class="line">git clone https://github.com/YMFE/yapi.git vendors //或者下载 zip 包解压到 vendors 目录（clone 整个仓库大概 140+ M，可以通过 `git clone --depth=1 https://github.com/YMFE/yapi.git vendors` 命令减少，大概 10+ M）</span><br><span class="line">cp vendors/config_example.json ./config.json //复制完成后请修改相关配置</span><br><span class="line">cd vendors</span><br><span class="line">npm install --production --registry https://registry.npm.taobao.org</span><br><span class="line">npm run install-server //安装程序会初始化数据库索引和管理员账号，管理员账号名可在 config.json 配置</span><br><span class="line">node server/app.js //启动服务器后，请访问 127.0.0.1:&#123;config.json配置的端口&#125;，初次运行会有个编译的过程，请耐心等候</span><br></pre></td></tr></table></figure>

<h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><p>启动yapi:  /home/dyys/my-yapi/start-yapi.sh</p>
<p>利用pm2方便服务管理维护。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">npm install pm2 -g  //安装pm2</span><br><span class="line">cd  &#123;项目目录&#125;</span><br><span class="line">pm2 start &quot;vendors/server/app.js&quot; --name yapi //pm2管理yapi服务</span><br><span class="line">pm2 info yapi //查看服务信息</span><br><span class="line">pm2 stop yapi //停止服务</span><br><span class="line">pm2 restart yapi //重启服务</span><br></pre></td></tr></table></figure>

<h1 id="安装gitweb"><a href="#安装gitweb" class="headerlink" title="安装gitweb"></a>安装gitweb</h1><p>参考：<br><a target="_blank" rel="noopener" href="http://aandds.com/blog/tool-fcgiwrap.html">fcgiwrap和nginx安装</a></p>
<p><a target="_blank" rel="noopener" href="https://windard.com/blog/2020/06/26/Linux-Service">Systemctl用法详解</a></p>
<h2 id="安装和配置fcgiwrap"><a href="#安装和配置fcgiwrap" class="headerlink" title="安装和配置fcgiwrap"></a>安装和配置fcgiwrap</h2><ul>
<li>安装： <code>yum install fcgiwrap</code></li>
<li>启动：<code>systemctl status fcgiwrap.service</code></li>
</ul>
<p>文件 <code>/lib/systemd/system/fcgiwrap.service</code> ：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Simple CGI Server</span><br><span class="line">After=nss-user-lookup.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">EnvironmentFile=/etc/sysconfig/fcgiwrap</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">ExecStart=/usr/sbin/fcgiwrap <span class="variable">$&#123;DAEMON_OPTS&#125;</span> -c <span class="variable">$&#123;DAEMON_PROCS&#125;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 方式一：nohup fcgiwrap -f -c 4 -s unix:/run/fcgiwrap.socket &amp; ：nginx和web服务必须是一台电脑</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 方式二：nohup fcgiwrap -f -c 4 -s tcp:0.0.0.0:9000 &amp; ：两台电脑</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动 2 个 fcgiwrap worker 进程</span></span><br><span class="line">ExecStart=/usr/sbin/fcgiwrap -f -c 2 -s unix:/run/fcgiwrap.socket</span><br><span class="line"><span class="meta">#</span><span class="bash"> 暂停1秒，等待 /run/fcgiwrap.socket 生成</span></span><br><span class="line">ExecStartPost=/bin/sleep 1</span><br><span class="line">ExecStartPost=/usr/bin/chown nginx:nginx /run/fcgiwrap.socket</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">User=nginx</span></span><br><span class="line"><span class="meta">#</span><span class="bash">Group=nginx</span></span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line"><span class="meta">#</span><span class="bash">WantedBy=multi-user.target</span></span><br><span class="line"><span class="meta">#</span><span class="bash">Also=fcgiwrap.socket</span></span><br></pre></td></tr></table></figure>
<ul>
<li>修改监听套接字文件的 owner：<code>chown nginx:nginx /var/run/fcgiwrap.socket</code>。 fcgiwrap.service文件已经写入，可以省去。</li>
<li>自启动： <code>systemctl enabled fcgiwrap.service</code></li>
</ul>
<h2 id="安装gitweb-1"><a href="#安装gitweb-1" class="headerlink" title="安装gitweb"></a>安装gitweb</h2><p><code>yum install gitweb</code></p>
<p>默认gitweb是安装到apache目录中的，也就是/var/www/git目录下，专门用来显示gitweb页面</p>
<h2 id="配置nginx"><a href="#配置nginx" class="headerlink" title="配置nginx"></a>配置nginx</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">location /gitweb.cgi &#123;</span><br><span class="line">     root /var/www/git/;</span><br><span class="line">	 include fastcgi_params;</span><br><span class="line">     gzip off;</span><br><span class="line">     fastcgi_param SCRIPT_NAME /var/www/git/gitweb.cgi;</span><br><span class="line">     fastcgi_param GITWEB_CONFIG /etc/gitweb.conf;</span><br><span class="line">     fastcgi_pass  unix:/var/run/fcgiwrap.socket;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">location / &#123;</span><br><span class="line">    root /var/www/git/;</span><br><span class="line">    index gitweb.cgi;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="配置ReviewBoard的Repository"><a href="#配置ReviewBoard的Repository" class="headerlink" title="配置ReviewBoard的Repository"></a>配置ReviewBoard的Repository</h2><p>Raw File URL Mask: <a target="_blank" rel="noopener" href="http://192.168.31.200:8180/?p=blocks/blocks-components.git;a=blob_plain;f=">http://192.168.31.200:8180/?p=blocks/blocks-components.git;a=blob_plain;f=</a><filename>;h=<revision></p>
<h1 id="整合gogs-与-ReviewBoard"><a href="#整合gogs-与-ReviewBoard" class="headerlink" title="整合gogs 与 ReviewBoard"></a>整合gogs 与 ReviewBoard</h1><p>reviewboard 对 gogs 这种第三方的git仓库支持，在添加<code>Repository</code>时，只能通过<code>Raw file URL mask</code>来实现。<br><a target="_blank" rel="noopener" href="https://github.com/gogs/gogs/issues/4857">Add get blob API #4857</a></p>
<p>错误：<br><a target="_blank" rel="noopener" href="https://www.mail-archive.com/reviewboard@googlegroups.com/msg20895.html">Re: fatal: Not a git repository: ‘None’ (HTTP 400, API Error 224)</a></p>
<p>rbtools.api.errors.BadRequestError: fatal: not a git repository: ‘None’</p>
<p>示例：<br>Repository type: Git<br>Path: <a target="_blank" rel="noopener" href="http://cddyys.ddns.net:3000/blocks/blocks-components.git">http://cddyys.ddns.net:3000/blocks/blocks-components.git</a><br>Raw File URL Mask: <a target="_blank" rel="noopener" href="http://cddyys.ddns.net:3000/blocks/blocks-components/raw/2.0.x/">http://cddyys.ddns.net:3000/blocks/blocks-components/raw/2.0.x/</a><filename>?id=<revision></p>
<p>git diff –full-index &gt;b.diff</p>
<p>rbt post -p -d –tracking-branch=origin/2.0.x –diff-filename=a.diff –summary=init_blog –description= “complete blog index” –target-people=guanjh</p>
<h1 id="调试ex-user"><a href="#调试ex-user" class="headerlink" title="调试ex-user"></a>调试ex-user</h1><ul>
<li>注释掉Task.class的@Component，WebDestroyAction.class的@Component</li>
</ul>
<h1 id="spring容器启动后执行"><a href="#spring容器启动后执行" class="headerlink" title="spring容器启动后执行"></a>spring容器启动后执行</h1><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/xiaojin21cen/article/details/83418470">Spring 容器启动完成后，执行初始化加载工作</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InitBeanTest</span> <span class="keyword">implements</span> <span class="title">ApplicationListener</span>&lt;<span class="title">ContextRefreshedEvent</span>&gt; </span>&#123;</span><br><span class="line">	<span class="comment">// 此方法会被多次调用</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onApplicationEvent</span><span class="params">(ContextRefreshedEvent event)</span> </span>&#123;</span><br><span class="line">		<span class="comment">/**</span></span><br><span class="line"><span class="comment">		在web 项目中，存在两个容器，一个是root application context，另一个就是我们自己的 projectName-servlet context（作为 root application context 的子容器）。</span></span><br><span class="line"><span class="comment">		这种情况下，就会造成 onApplicationEvent 方法被执行两次。</span></span><br><span class="line"><span class="comment">		为了避免上面提到的问题，我们可以只在 root application context 初始化完成后调用逻辑代码</span></span><br><span class="line"><span class="comment">		*/</span></span><br><span class="line">		<span class="keyword">if</span>(event.getApplicationContext().getParent() == <span class="keyword">null</span>)&#123;<span class="comment">//root application context 没有parent</span></span><br><span class="line">            <span class="comment">//TODO 这里写下将要初始化的内容</span></span><br><span class="line">        &#125;</span><br><span class="line">	&#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="在spring-boot工程环境的junit测试"><a href="#在spring-boot工程环境的junit测试" class="headerlink" title="在spring-boot工程环境的junit测试"></a>在spring-boot工程环境的junit测试</h1><h2 id="基于纯spring方式"><a href="#基于纯spring方式" class="headerlink" title="基于纯spring方式"></a>基于纯spring方式</h2><p>此方式事务是起作用的。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:annotation-config</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.ex&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Controller&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.web.bind.annotation.RestController&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.boot.autoconfigure.SpringBootApplication&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.web.servlet.config.annotation.EnableWebMvc&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">&quot;assignable&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;com.ex.web.aspect.AppSignCheck&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">&quot;assignable&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;com.ex.admin.aspect.AdminPermissionAspect&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.dyys.framework.util.SpringHelper&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dsMain&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">tx:annotation-driven</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- DAO接口所在包名，Spring会自动查找其下的类 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;mainSqlScannerConfigurer&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.beetl.sql.ext.spring.BeetlSqlScannerConfigurer&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 哪些类可以自动注入 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;basePackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.ex&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 通过类后缀 来自动注入Dao --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;daoSuffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Mapper&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sqlManagerFactoryBeanName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;mainSqlManager&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;mainSqlManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.beetl.sql.ext.spring.SqlManagerFactoryBean&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;cs&quot;</span> &gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span>  <span class="attr">class</span>=<span class="string">&quot;org.beetl.sql.ext.spring.SpringConnectionSource&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;masterSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dsMain&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 还可以设置从数据库 slaves --&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dbStyle&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.beetl.sql.core.db.MySqlStyle&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sqlLoader&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.beetl.sql.core.loader.MarkdownClasspathLoader&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sqlRoot&quot;</span> <span class="attr">value</span>=<span class="string">&quot;sql&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;nc&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.beetl.sql.core.DefaultNameConversion&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;interceptors&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.beetl.sql.ext.DebugInterceptor&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>测试用例为</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;classpath:application.properties&quot;)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(locations = &#123;&quot;classpath*:spring-test.xml&quot;&#125;)</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration(exclude= WebMvcAutoConfiguration.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CoinTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CoinService coinService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCoinAndFinanceAccount</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Coin coin = <span class="keyword">new</span> Coin(<span class="string">&quot;WKKk&quot;</span>, CoinGroup.MAINSTREAM_COIN.value());</span><br><span class="line">        Long adminId = <span class="number">11L</span>;</span><br><span class="line">        coin = coinService.addCoinAndFinanceAccount(coin, adminId);</span><br><span class="line">        Assert.assertNotNull(coin);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="基于spring-boot方式"><a href="#基于spring-boot方式" class="headerlink" title="基于spring-boot方式"></a>基于spring-boot方式</h2><p>此方式事务不起作用。<br>重写一个Application类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication(exclude= WebMvcAutoConfiguration.class)</span></span><br><span class="line"><span class="meta">@ComponentScan(excludeFilters = &#123;</span></span><br><span class="line"><span class="meta">        @ComponentScan.Filter(type= FilterType.ASSIGNABLE_TYPE, value = &#123;WebApplication.class, AppSignCheck.class,</span></span><br><span class="line"><span class="meta">                AdminPermissionAspect.class&#125;),</span></span><br><span class="line"><span class="meta">        @ComponentScan.Filter(type= FilterType.ANNOTATION, value=&#123;EnableWebMvc.class, Controller.class, RestController.class&#125;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(TestApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Order(-100)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SpringHelper <span class="title">springHelper</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SpringHelper();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试用例为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest(classes = TestApplication.class, webEnvironment = SpringBootTest.WebEnvironment.NONE)</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CoinServiceTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CoinService coinService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCoinAndFinanceAccount</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Coin coin = <span class="keyword">new</span> Coin(<span class="string">&quot;WKKk&quot;</span>, CoinGroup.MAINSTREAM_COIN.value());</span><br><span class="line">        Long adminId = <span class="number">11L</span>;</span><br><span class="line">        coin = coinService.addCoinAndFinanceAccount(coin, adminId);</span><br><span class="line">        Assert.assertNotNull(coin);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="mintty乱码"><a href="#mintty乱码" class="headerlink" title="mintty乱码"></a>mintty乱码</h1><p>在cmder的settings -&gt; 启动 -&gt; 任务 中设置：<br><code>mintty -o Locale=zh_CN -o Charset=GBK</code></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/06/28/Doing/%E5%B7%A5%E4%BD%9C%E6%97%A5%E5%BF%97/" data-id="ckqg285sp0005rcfphm7hdl7i" data-title="" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2021/06/28/Doing/%E6%8C%96%E7%9F%BF%E7%9A%847%E4%B8%AA%E6%AD%A5%E9%AA%A4/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          (no title)
        
      </div>
    </a>
  
  
    <a href="/2021/06/28/Doing/wankoko/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title"></div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">June 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/06/28/product/%E9%9C%80%E6%B1%82%E8%B0%83%E7%A0%94%E7%9A%84%E5%86%85%E5%AE%B9%E5%92%8C%E5%B7%A5%E4%BD%9C%E6%8C%87%E5%BC%95/">(no title)</a>
          </li>
        
          <li>
            <a href="/2021/06/28/product/%E9%93%81%E8%B7%AF6C%E4%B8%9A%E5%8A%A1%E7%BB%93%E6%9E%84/">(no title)</a>
          </li>
        
          <li>
            <a href="/2021/06/28/product/%E9%9C%80%E6%B1%82%E8%B0%83%E7%A0%94%E5%8F%8A%E5%88%86%E6%9E%90%E6%96%B9%E6%B3%95/">(no title)</a>
          </li>
        
          <li>
            <a href="/2021/06/28/product/%E6%B0%B4%E7%94%B5%E7%AB%99%E7%94%9F%E4%BA%A7%E8%BF%90%E8%A1%8C%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/">(no title)</a>
          </li>
        
          <li>
            <a href="/2021/06/28/product/%E6%B0%B4%E7%94%B5%E5%8E%82%E8%BF%90%E8%A1%8C%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>