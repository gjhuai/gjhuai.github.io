<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
<link rel="stylesheet" href="../theme/css/my.css" /><h2>Consul 原理和使用简介</h2>
<p><a href="https://blog.coding.net/blog/intro-consul">Consul 原理和使用简介</a></p>
<ul>
<li>
<p>Consul 是什么
Consul 是一个支持多数据中心分布式高可用的服务发现和配置共享的服务软件，由 HashiCorp 公司用 Go 语言开发，基于 Mozilla Public License 2.0 的协议进行开源。Consul 支持健康检查,并允许 HTTP 和 DNS 协议调用 API 存储键值对。
命令行超级好用的虚拟机管理软件 vgrant 也是 HashiCorp 公司开发的产品。
一致性协议采用 Raft 算法，用来保证服务的高可用。使用 GOSSIP 协议管理成员和广播消息，并且支持 ACL 访问控制。</p>
</li>
<li>
<p>功能特点</p>
<ul>
<li>服务发现：Consul的客户端可以提供的服务，如api或mysql,其他的客户端可以使用Consul发现一个特定服务的提供者。使用DNS或HTTP，应用程序可以很容易地找到他们所依赖的服务。</li>
<li>健康检查：Consul客户端可以提供任何数量的健康检查,无论是与给定的服务(“Web服务器返回200 OK”),还是和本地节点相关联("内存利用率低于90%")。这些信息可以由操作员监控集群健康,它用于由服务发现组件将通信路由远离不健康的主机。</li>
<li>键/值存储：应用程序可以使用Consul的分层键/值存储任意数量的目标,包括动态配置,特征衰弱,leader选举,等等。简单的HTTP API使得它易于使用。</li>
<li>多数据中心：Consul支持多个数据中心,这意味着Consul的用户不用担心构建额外的抽象层增加到多个区域。</li>
</ul>
</li>
<li>
<p>Consul 的优势</p>
<ul>
<li>使用 Raft 算法来保证一致性，比复杂的 Paxos 算法更直接。相比较而言, zookeeper 采用的是 Paxos，而 etcd 使用的则是 Raft。</li>
<li>支持多数据中心，内外网的服务采用不同的端口进行监听。多数据中心集群可以避免单数据中心的单点故障，而其部署则需要考虑网络延迟、分片等情况等。zookeeper 和 etcd 均不提供多数据中心功能的支持。</li>
<li>支持健康检查。etcd 不提供此功能。</li>
<li>支持 http 和 dns 协议接口。zookeeper 的集成较为复杂，etcd 只支持 http 协议。</li>
<li>官方提供web管理界面，etcd 无此功能。</li>
</ul>
</li>
<li>
<p>Consul 的角色</p>
<ul>
<li>client: 客户端，无状态，将 HTTP 和 DNS 接口请求转发给局域网内的服务端集群。</li>
<li>server: 服务端，保存配置信息，高可用集群，在局域网内与本地客户端通讯，通过广域网与其他数据中心通讯。每个数据中心的 server 数量推荐为 3 个或是 5 个。</li>
</ul>
</li>
</ul>
<h2>Consul 架构</h2>
<p><a href="http://devopsh.com/726.html">Consul 架构</a></p>
<ul>
<li>
<p>Agent 代理是长时间运行的守护进程在每个Consul集群的成员。它是由Consul代理运行。代理能够在客户机或服务器上运行模式。由于所有节点都必须运行一个代理,它是简单的参考节点作为一个客户端或服务器,但还有其他代理的实例。所有代理可以运行DNS或HTTP接口,并负责运行检查和保持服务同步。</p>
</li>
<li>
<p>Client 客户端是转发所有的RPC到服务器的代理。客户端是相对无状态的。客户端执行的唯一背景活动是正在LAN八卦池(gossip pool)的一部分。这具有最小资源开销，仅消耗少量的网络带宽。</p>
</li>
<li>Server 服务器是一套扩展的职责包括参与Raft仲裁，维护集群状态，响应RPC查询，WAN八卦(gossip)到其他数据中心，并转发查询的主导者或远程数据中心的代理人。</li>
<li>Datacenter 数据中心似乎是显而易见的，但也有微妙的细节，如EC2多个可用区。 我们定义了一个数据中心是一个联网环境是私有的，低延迟和高带宽。 这不包括通信，将穿越公共互联网。</li>
<li>Consensus 当我们的文档中使用，我们使用的共识，意味着在交易的订货经选举产生的领导人达成协议以及协议。 由于这些事务应用到FSM，我们隐含地包括一个复制的状态机的一致性。 共识进行了更详细的描述维基百科 ，和我们的实施进行说明此处。</li>
<li>Gossip Consul是建立在之上Sref ，它提供了一个完整的gossip protocol是用于多种用途。 Sref实行会员制，故障检测和事件广播机制。我们使用这些描述更多的gossip documentation 。 这足以知道，gossip涉及随机节点到节点通信，主要是通过UDP。</li>
<li>LAN Gossip 指LAN八卦池(Refers to the LAN gossip pool),它包含了所有位于同一局域网络或数据中心上的节点。</li>
<li>WAN Gossip 指WAN八卦池(Refers to the WAN gossip pool)，其中只包含服务器。这些服务器主要位于不同的数据中心，并且通常通信通过互联网或广域网。</li>
<li>RPC 远程过程调用。这是一个请求/响应机制，允许一个客户端，使一服务器的请求。</li>
</ul>
<p><img alt="" src="_v_images/2019-11-29-17-25-55.png" /></p>
<h2>如何用Consul打造弹性可扩展的PaaS平台</h2>
<p><a href="http://os.51cto.com/art/201601/504856.htm">如何用Consul打造弹性可扩展的PaaS平台</a></p>
<h2>Consul和ZooKeeper的区别</h2>
<p><a href="http://dockone.io/article/300"> Consul和ZooKeeper的区别 </a></p>
<p><a href="http://it.dataguru.cn/article-8131-1.html"> 服务发现：Zookeeper vs etcd vs Consul </a></p>