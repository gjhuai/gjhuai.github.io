<p>[TOC]</p>
<h1>Gradle介绍</h1>
<h2>1 纲要</h2>
<h3>1.1 项目、文件及目录</h3>
<ul>
<li>build.gradle  主编译文件</li>
<li>gradle.properties 属性文件</li>
<li>settings.gradle   项目配置文件</li>
</ul>
<pre><code class="language-groovy">src {   //目录结构而已，不是代码
   main {
       java
       resources
   }
   test {
       java
       resources
   }
}
</code></pre>
<h3>1.2 plugin</h3>
<ul>
<li>apply plugin: "java"</li>
<li>apply plugin: "eclipse"</li>
<li>apply plugin: "eclipse-wtp"</li>
<li>apply plugin: "idea"</li>
</ul>
<h3>1.3 dependency</h3>
<p>group:name/artifact:version
查看：http://192.168.0.207:8081/nexus/content/groups/public/</p>
<p>几种Scope： compile, runtime, testCompile, testRuntime</p>
<pre><code class="language-groovy">apply plugin: 'java'

repositories {
    mavenCentral()
}

dependencies {
    compile project(':shared')

    testCompile 'junit:junit:4.11'

    runtime files('libs/a.jar', 'libs/b.jar')
    runtime fileTree(dir: 'libs', include: '*.jar')
}
</code></pre>
<p>排除传递依赖</p>
<pre><code class="language-groovy">configurations {
    compile.exclude module: 'commons'
    all*.exclude group: 'org.gradle.test.excludes', module: 'reports'
}

dependencies {
    compile(&quot;org.gradle.test.excludes:api:1.0&quot;) {
        exclude module: 'shared'
    }
    compile (&quot;com.alibaba:dubbo:2.5.3&quot;) { transitive = false }
}
</code></pre>
<p>查看依赖Tree： gradle dependencies &gt; dependencies.txt</p>
<h3>1.4 task</h3>
<ul>
<li>默认任务</li>
</ul>
<pre><code class="language-groovy"> E:\gradle_project&gt;gradle build 
 :compileJava 
 :processResources 
 :classes 
 :jar 
 :assemble 
 :compileTestJava 
 :processTestResources 
 :testClasses 
 :test 
 :check 
 :build 

 BUILD SUCCESSFUL
</code></pre>
<ul>
<li>自定义任务</li>
</ul>
<pre><code class="language-groovy">task hello &lt;&lt; {     // &lt;&lt; 向Task的actions集合里添加Action
    println 'Hello 2'
}
hello.doFirst {
    println 'Hello 1'
}
hello.doLast {
    println 'Hello 3'
}
hello &lt;&lt; {
    println 'Hello 4'
}
</code></pre>
<p><strong>指定任务类型</strong> : 通过参数type指定该task的类型后，就可以使用该类型task提供的特殊变量或函数。</p>
<pre><code class="language-groovy">task copyDocs(type: Copy) {
    from 'src/main/doc'
    into 'build/target/doc'
}
</code></pre>
<p><strong>Task依赖</strong></p>
<pre><code class="language-groovy">task scp(dependsOn:assemble) {
    ......
}

taskX.dependsOn taskY
</code></pre>
<h2>2 重点</h2>
<h3>创建项目</h3>
<p><code>gradle init --type java-library</code> 创建java项目
<code>gradle init --type pom</code>   转换maven项目</p>
<h3>常用指令</h3>
<ul>
<li>gradle assemble</li>
<li>gradle build</li>
<li>gradle dependencies</li>
<li>gradle clean</li>
<li>gradle jar</li>
<li>gradle war</li>
<li>gradle check</li>
<li>gradle test</li>
<li>gradle classes</li>
</ul>
<h3>变量与字符串</h3>
<p>"$username"  vs  '$username'</p>
<p>"${project.name}"  vs "$project.name"</p>
<h4>常用属性</h4>
<p>project.name 可简写为$name, $name 在Task中表示taskName
project.version</p>
<pre><code class="language-groovy">version = '1.0'
buildDir = &quot;target&quot;

sourceSets {
    main {
        java {
            srcDir 'src/java'
        }
        resources {
            srcDir 'src/resources'
        }

        output.resourcesDir = &quot;${buildDir}/classes/main&quot;
    }
}
</code></pre>
<h3>定义属性</h3>
<p>查看属性： gradle properties</p>
<ul>
<li>System Properties : 指JVM的system properties
    gradle xxx -DmySystemProp=xxxx</li>
<li>Project Properties : Gradle专门为Project定义的属性</li>
</ul>
<pre><code class="language-groovy">    gradle xxx -PmyProjectProp=xxxxx

    if (project.hasProperty(&quot;profile&quot;)) {
        //System.setProperty(&quot;spring.profiles.active&quot;, project[&quot;profile&quot;])
        profile = project[&quot;profile&quot;]
    }
</code></pre>
<ul>
<li>Ext Properties : 动态属性</li>
</ul>
<pre><code class="language-groovy">ext {
    if (project.hasProperty(&quot;profile&quot;)) {
        profile = project[&quot;profile&quot;]
    } else  {
        profile = &quot;dev&quot;
    }
    profiles =  [&quot;dev&quot;, &quot;prod&quot;, &quot;demo&quot;]

    serverRoot = &quot;tomcat_dip&quot;
}
</code></pre>
<h3>多项目构建</h3>
<ul>
<li>多项目定义及结构
settings.gradle</li>
</ul>
<pre><code class="language-groovy">include 'dip-appbox-service'
include 'dip-appbox-web'

include 'idbp-res'; project(&quot;:idbp-res&quot;).projectDir = file(&quot;../idbp-res&quot;)
include 'idbp-portal'; project(&quot;:idbp-portal&quot;).projectDir = file(&quot;../idbp-core/idbp-portal&quot;)
</code></pre>
<ul>
<li>
<p>多项目的集中配置</p>
<ul>
<li>allprojects{xxx} 这段代码表示，对于所有的project</li>
<li>subprojects{xxxx}的这段代码表示，对于所有的子project</li>
<li>project(':core'){xxxx}</li>
</ul>
</li>
<li>
<p>多项目的Task执行</p>
</li>
</ul>
<pre><code class="language-groovy">allprojects{
    task hello &lt;&lt;{
        println &quot;hello world&quot;
    }
}
</code></pre>
<p>gradle hello : 在所有项目上执行
gradle :core:hello : 仅在core项目上执行，等效于进入core项目根目录，直接执行gradle hello</p>
<h3>包含文件</h3>
<p>apply from: "./libraries.gradle"</p>
<h3>几个常用插件</h3>
<p>apply plugin: 'maven-publish'</p>
<p>scp</p>
<pre><code class="language-groovy">configurations {
    sshAntTask
}

dependencies {
    sshAntTask &quot;org.apache.ant:ant-jsch:1.7.1&quot;, &quot;jsch:jsch:0.1.29&quot;
}

task scp(dependsOn:assemble) {
    doLast  {
        ant.taskdef(name: 'sshexec',
            classname: 'org.apache.tools.ant.taskdefs.optional.ssh.SSHExec',
            classpath: project.configurations.sshAntTask.asPath)
        ant.sshexec(host: &quot;${serverIP}&quot;, username: &quot;${serverAccount}&quot;, password: &quot;${serverPwd}&quot;,
            command: &quot;cd ${serverRoot}/appbox/; /bin/bash -l ./shutdown.sh; rm -rf webapps/ROOT*; rm -rf work;&quot;, trust: 'true', failonerror: 'true')

        ant.taskdef(
            name: &quot;scp&quot;,
            classname: &quot;org.apache.tools.ant.taskdefs.optional.ssh.Scp&quot;,
            classpath: configurations.sshAntTask.asPath)

        ant.scp(todir: &quot;${serverAccount}:${serverPwd}@${serverIP}:~/${serverRoot}/appbox/webapps&quot;, trust: true){
            fileset(dir: &quot;${project.buildDir}/libs&quot;) {
                include(name: &quot;**/*.war&quot;)      // in as a parameter to the
            }
        }

        ant.sshexec(host: &quot;${serverIP}&quot;, username: &quot;${serverAccount}&quot;, password: &quot;${serverPwd}&quot;,
            command: &quot;cd ${serverRoot}/appbox/;/bin/bash -l ./startup.sh&quot;, trust: 'true', failonerror: 'true')
    }
}
</code></pre>