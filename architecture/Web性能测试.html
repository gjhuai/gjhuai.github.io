<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
<link rel="stylesheet" href="../theme/css/my.css" /><p>[toc]</p>
<h1>性能指标</h1>
<p>参考：</p>
<ul>
<li><a href="http://www.ha97.com/5095.html">系统吞吐量（TPS）、用户并发量、性能测试概念和公式</a></li>
<li><a href="https://ruby-china.org/topics/26221">吞吐率、吞吐量、TPS、性能测试，纸上不谈兵----一步一步构建高性能 Web 站点</a></li>
<li><a href="http://coolshell.cn/articles/2589.html">十个免费的Web压力测试工具</a></li>
</ul>
<h2>Throughput（吞吐量）</h2>
<p>按照常规理解网络吞吐量表示在单位时间内通过网卡数据量之和，其中即包括本机网卡发送出去的数据量也包括本机网卡接收到的数据量。 一个100Mb(位)的双工网卡，最大发送数据的速度是12.5M字节/s ， 最大接收数据的速度是12.5M字节/s， 可以 同时 收发 数据。 
<strong> 并发用户数 </strong> ：是同时执行操作的用户(线程数)。 
<strong> 响应时间 </strong> ：从请求发出到收到响应花费的时间 。</p>
<h2>QPS</h2>
<ul>
<li>每秒查询率(Query Per Second)  每秒处理的查询数（如果是数据库，就相当于读取）</li>
<li>每秒查询率QPS是对一个特定的查询服务器在规定时间内所处理流量多少的衡量标准，在因特网上，作为域名系统服务器的机器的性能经常用每秒查询率来衡量。</li>
<li>对应fetches/sec，即每秒的响应请求数，也即是最大吞吐能力。</li>
<li>说明：这里说明每秒N个请求，就是 QPS 。而不是请求一个html页面而附带请求的css,js,图片。因为我关心的是应用程序处理业务的能力。 </li>
</ul>
<h2>TPS</h2>
<ul>
<li>Transactions Per Second  每秒处理的事务数(如果是数据库，就相当于写入、修改)</li>
</ul>
<p>例如对某个数据库测试，分开两次测QPS与TPS。
QPS（读取）值总是高于TPS(写、改)，并且有倍率关系，因为：
1、数据库对查询可能有缓存。
2、机械硬盘或SSD硬盘的读就是比写快。 </p>
<h2>IOPS</h2>
<p>每秒磁盘进行的I/O操作次数</p>
<h2>PV</h2>
<h2>QPS计算PV和机器的方式</h2>
<p>QPS统计方式 [一般使用 http_load 进行统计]
 QPS = 总请求数 / ( 进程总数 *   请求时间 )
 QPS: 单个进程每秒请求服务器的成功次数</p>
<ul>
<li>
<p>单台服务器每天PV计算
 公式1：每天总PV = QPS * 3600 * 6
 公式2：每天总PV = QPS * 3600 * 8</p>
</li>
<li>
<p>服务器计算
 服务器数量 =   ceil( 每天总PV / 单台服务器每天总PV )</p>
</li>
</ul>
<h2>【峰值QPS和机器计算公式】</h2>
<p>原理：每天80%的访问集中在20%的时间里，这20%时间叫做峰值时间
 公式：( 总PV数 * 80% ) / ( 每天秒数 * 20% ) = 峰值时间每秒请求数(QPS)
 机器：峰值时间每秒QPS / 单台机器的QPS   = 需要的机器</p>
<p>问：每天300w PV 的在单台机器上，这台机器需要多少QPS？
 答：( 3000000 * 0.8 ) / (86400 * 0.2 ) = 139 (QPS)</p>
<p>问：如果一台机器的QPS是58，需要几台机器来支持？
 答：139 / 58 = 3</p>
<h1>测试</h1>
<p>参考：
- <a href="http://developer.51cto.com/art/201106/267717.htm">性能测试vs负载测试vs压力测试</a></p>
<h2>性能测试（Performance Test）</h2>
<p>性能测试主要评价系统或组件的性能是否和具体的性能需求一致，例如：对访问速度的性能需求或对内存使用情况的需求。特定性能测试的关注点在于组件或系统在规定的时间内和特定的条件下响应用户或系统输入的能力。</p>
<p>不同的性能的度量方法取决于不同的被测对象。对于一个单独软件组件，其性能可以根据CPU主频来判定。而带客户端的系统，其性能则要根据系统处理特定用户请求的响应时间来判定。对于那些由多种组件（如客户端、服务器、数据库）构成的系统，则要进行各组件之间的性能测试。</p>
<h2>负载测试（Load Test）</h2>
<p>负载测试是一种通过增加负载来评估组件或系统的性能的测试方法。例如：通过增加并发用户数和（或）事务数量来测量组件或系统能够承受的负载。负载测试和性能测试的主要区别在于负载测试时，系统负载是逐渐增加的，而不是一步到位，负载测试需要观察系统在各种不同的负载情况下是否都能够正常工作。</p>
<h2>压力测试（Stress Test）</h2>
<p>压力测试是评估系统处于或超过预期负载时系统的运行情况。压力测试的关注点在于系统在峰值负载或超出最大载荷情况下的处理能力。在压力级别逐渐增加时，系统性能应该按照预期缓慢下降，但是不应该崩溃。压力测试还可以发现系统崩溃的临界点，从而发现系统中的薄弱环节。</p>
<p>例如：系统最大支持的同时在线用户数是1000个，压力测试需要测试在1000个用户甚至2000个用户同时在线时系统的表现。虽然测试时负载已经超过了系统的设计能力，但是在这种情况下被测试系统也不应该发生崩溃。压力测试也可以针对系统资源进行测试，例如：在系统内存耗尽情况下，测试系统的运行情况，这种情况下被测试系统也不应该崩溃。</p>
<hr />
<p>一个完整的压力测试需要关注三个方面：如何正确产生压力、如何定位瓶颈、如何预估系统的承载能力</p>
<p>(1) 首先说一下如何产生压力，产生压力的方法有很多，通常可以写脚本产生压力机器人对服务器进行发包和收包操作，也可以使用现有的工具(像jmeter、LoadRunner这些），所以说产生压力其实并不难， 难点在于产生的压力是不是真实地反映了实际用户的操作场景 。举个例子来说，对游戏来说单纯的并发登陆场景在整个线上环境中的占比可能并不大(新开服等特殊情况除外)，相反“登陆-开始战斗-结束战斗”、不同用户执行不同动作这种“混合模式”占了更大的比重。所以如何从实际环境中提炼出具体的场景比重，并且把这种比重转化成实际压力是一个重要的关注点。</p>
<p>(2) 产生压力之后，通常我们可以拿到TPS、响应时延等性能数据，那么 如何定位性能问题 呢？TPS、响应时延只能告诉你服务器是否存在问题，但不能帮助你定位问题。这些表面背后是整个后台处理逻辑综合作用的结果，这时候可以先关注系统的CPU、内存、IO、网络，对比在tps、时延达到瓶颈时这些系统数据的情况，确定性能问题是系统哪一部分造成的，然后再回到代码的逻辑中逐个优化这些点。</p>
<p>(3) 当服务器的整体性能可以相对稳定下来，这时候就需要对自己服务器的承载能力有一个预估，通过产生真实压力、对比系统数据，大致可以对单套系统的处理能力有个真实的评价，然后结合业务规模配置服务器数量。可以看下腾讯wetest的这个压测工具http://wetest.qq.com/gaps/</p>
<p>总结一下：通过产生真实压力来发现问题、结合系统性能来解决问题</p>