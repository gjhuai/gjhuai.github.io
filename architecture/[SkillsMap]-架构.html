<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
<link rel="stylesheet" href="../theme/css/my.css" /><h1>分析设计</h1>
<ul>
<li><a href="https://www.axure.com.cn/2966">用 Axure 写产品需求文档实例</a><ul>
<li><a href="http://demo.axureshop.com/?url=http://cloud.axureshop.com/pvpap1&amp;buyurl=https://www.axureshop.com/a/1176518.html">AxureShop 原型演示</a></li>
</ul>
</li>
<li><a href="https://zhuanlan.zhihu.com/p/85037211">常用的软件需求说明书模板</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/81875474">10.软件需求最佳实践笔记 | 需求描述</a></li>
<li><a href="https://juejin.cn/post/6844903863619698696">架构实战：架构设计文档模板</a></li>
</ul>
<h1>1、前后端分离</h1>
<h2>前提</h2>
<ul>
<li>需求明确，需求领先开发一个周期</li>
<li>有明确的设计，特别是接口设计，接口文档需要管理，可以采用软件，如swagger</li>
</ul>
<h2>公共组件</h2>
<ul>
<li>Mock Server支持</li>
<li>持续集成 + 单元测试（方便debug、回归测试）</li>
<li>公共业务接口（如：findById、查询接口可配置），接口遵循REST</li>
<li>接口转换层（easyui格式转换）</li>
</ul>
<h2>需要解决的问题</h2>
<ul>
<li>web层权限控制（Freemarker标签？）</li>
<li>接口API权限控制</li>
<li>session管理</li>
<li>webpage框架（SpringMVC vs Ratpack vs NodeJS）</li>
<li>图片上传</li>
<li>前端校验</li>
<li>国际化</li>
</ul>
<h2>优点</h2>
<ul>
<li>前后端重构更容易；后端引入单元测试后，质量有提升</li>
<li>前端更多自主权，页面可做更多个性化的设计</li>
</ul>
<h2>要注意的</h2>
<ul>
<li>前端人员须到位，后端人员可以减半</li>
<li>后端负责业务逻辑，前端负责View+Controller，校验、上传、权限等</li>
<li>API遵循Restful风格</li>
<li>前后须加强沟通，接口必有文档，可通过Mock Server模拟接口</li>
</ul>
<h2>开发过程</h2>
<ul>
<li>设计接口：前端参与UI设计，决定前后端开发协作模式及职责，前后端一起确定业务接口。</li>
<li>开发阶段：前后端并行开发，后端使用JUnit进行单元测试，前端使用Mock Server进行测试；开发过程中双方可以协商变动接口。</li>
<li>部署：前后端集成测试</li>
</ul>
<h2>Mock Server</h2>
<p>根据接口文档自动生成假数据</p>
<ul>
<li><a href="https://github.com/dreamhead/moco">moco</a></li>
<li><a href="http://wiremock.org/index.html">wiremock</a></li>
</ul>
<h2>接口管理</h2>
<p>加入json-schema规则，实现了对http请求的参数校验。</p>
<ul>
<li><a href="http://rap.taobao.org/org/index.do">RAP</a></li>
<li><a href="http://swagger.io/"> swagger </a>.</li>
</ul>
<h2>模板</h2>
<p>用着一样的模版语言 XTemplate，一样的渲染引擎 JavaScript</p>
<p>在不同的渲染环境（Server-side、PC Browser、Mobile Browser、Web View、etc.）渲染出一样的结果。</p>
<h2>参考架构</h2>
<p>该解决方案，session，登录态什么的仍然是后端管理; 前端仍然只管理模板，只不过起了后台来管理模板；对后端来说，除了nginx配置改变几乎没有任何新的东西。</p>
<p><img alt="" src="_v_images/2019-11-29-17-53-12.png" /></p>
<h2>技术储备</h2>
<ul>
<li>BigPipe</li>
</ul>
<h2>基于Thrift前后端分离Demo</h2>
<p>一个难点在于web 与 services 的数据交互。好在facebook开源的一个项目 <a href="http://thrift.apache.org/">Thrift</a> 为我们解决了这个问题。
Demo中使用了Nodejs 的Express搭建web服务，使用 Thrift 生成 Node 的client和server的接口文件。</p>
<p><strong>Client</strong>:</p>
<pre><code class="language-javascript">

var  client = thrift.createClient(Calculator, connection);

router.get( '/', function (req, res, next)
{
    client.add( 10, 100 )
             .then( function (response) {
                   res.render( 'index', { title: 'Express + Thrift', desc: '：1+1='  + response });
            });   
});
/* jade */block content    h1= title    p Welcome to #{title
}
</code></pre>
<p><strong>Server</strong></p>
<pre><code class="language-javascript">/* Nodejs server */...var
server = thrift.createServer(Calculator, {

add: function (n1, n2)
{
var  result = n1 + n2;
return  result;
    }
});

console.log(&quot;localhost:9090&quot; );
server.listen( 9090);
</code></pre>
<h2>参考：</h2>
<ul>
<li><a href="https://github.com/weivea/FE-separate">前后端分离想法的一些实践</a></li>
</ul>
<h1>2、Node.js+后端REST架构</h1>
<h2>node.js不适合做全栈</h2>
<p>其实，没有哪个语言或框架适合做全栈，即使如Spring也不行（web层不轻量）。</p>
<p>node.js有一下缺陷：
- 臭名昭著的异步回调。上8层的异步调用嵌套实在难读和难以维护。
- javascript 的不严谨和 灵活性导致了程序在运行过程中很容易出现难以调试的Bug，而Bug的日志会让人摸不着头脑。
-  完全异步化带来的另一个问题就是调试困难。
-  没法直接发挥多核、多CPU的服务器的优势。
- 没有像Java一样的工程化体系、中间件、开源库。
-  要真正以node来支撑开发一个电商平台对JS工程师的要求非常高，我觉得业内这样的人才依然相当难觅，上手容易不等于高级功能也容易。</p>
<p>只作为web层 ：
-  如果你要做的是小型项目，或者逻辑非常简单的项目，可以选择Node.js，因为开发、调试都很很快。
-  如果你要做的是逻辑简单，而并发大的项目，可以选择Node.js，它还是很适合左右游戏的聊天服务器，长连接消息推送服务器之类的项目的。
-  在真正的重要的、大型的项目上请不要盲目，追求一些比如“语言层面的前后端统一”这样的议题，这是没有意义的。
-  paypal只是把web端开发从JSP切换成了node.js，系统平台里的该是什么还是什么。还有类似的例子就是Groupon，他们也用node重构了网页部分内容，沃尔玛亦然。</p>
<p>结论：
- 1、 如果能用Java做，就用Java做，参考淘宝网。
- 2、如果做大了需要升级用户体验，后端服务器接口化，前端服务器用Node.js替换，参考淘宝网前后端分离实践。
- 3、考虑到电商项目的失败率，项目有很大的可能走不到第二步，请先考虑第一步。
- 4、不是所有公司都像淘宝一样有大量的技术储备力量，去完成前后端分离，创业公司或不大的公司还是选择一种技术栈比较合适。</p>
<p>PS:
- Web服务器端一直都存在两个阵营，以Java/C#为代表的工业设计语言和以PHP/RoR为代表的快速开发语言。前者一直牢牢地占据着企业应用开发市场，而后者则普遍认为更适合灵活多变的互联网，Node.JS显然是属于后者的。
-    用 Java / JSP 来开发网站太过于重量过于繁琐了，不如 RoR / PHP 等动态脚本语言灵活快速。</p>
<h2>Node.js Web选型</h2>
<p><strong>Sinatra-like</strong>
- <a href="http://expressjs.com/">Express</a>
- <a href="http://koajs.cn/">koa.js</a>
- <a href="http://hapijs.com/">hapi</a></p>
<p>koa.js比Express先进最重要的一点：koa.js在coroute上所做工作，引入yield，不再需要多层的异步调用嵌套。</p>
<p><strong>Rails-like</strong>
- <a href="http://sailsjs.org/">sails</a></p>
<p>sails在windows下安装需要python2.7， VC++2010的支持，太麻烦，我没有安装试用。</p>
<p><strong>Node.js渲染模板</strong>
ICanHaz.js / mustache / hogan.js / Jade / Haml / /Slim / CoffeeKup / Markaby / ejs / eco 等</p>
<h2>使用node做web前端的好处</h2>
<ul>
<li>前后端分离是的业务层独立，更容易结合多种前端，如web和app。</li>
<li>如果可以用 JavaScript 来渲染页面，前端工程师就可以有更大的空间。</li>
<li>前端想要对页面进行重构优化的时候也不再需要打扰后端工程师，大家都可以更专注于自己的事情。</li>
</ul>
<h2>REST后端接口</h2>
<p>Java做后端优势：
 -  熟悉 Java 的工程师很多，我们很容易找到需要的人。
- Java 平台的性能已经的到多年的验证。
- Java 平台上众多的第三方产品、类库无所不有。
- 基于 JVM 的动态/函数式语言也给了 Java 平台良好的扩展性。</p>
<h1>3、基于dubbo的前后端分离</h1>
<p>基于dubbo的前后端分离分为两大类，一类是dubbo+阻塞前端WebServer，如dubbo+tomcat，dubbo+Apache PHP；另一类是duboo+异步非阻塞WebService，如：dubbo+nodejs， dubbo+ratpack。涉及到的前端WebServer有基于Java和非Java的，列举流行的几种说明：</p>
<h2>1. dubbo+nodejs</h2>
<p>nodejs与dubbo服务通信有两种方式：Hessian, jsonrpc。Hessian协议dubbo原本就支持，而jsonrpc协议需要另外实现，不过万幸Github上已经有人做了。</p>
<h3>jsonrpc</h3>
<p><a href="https://github.com/QianmiOpen/dubbo-rpc-jsonrpc"> QianmiOpen/ dubbo-rpc-jsonrpc</a>
<a href="https://github.com/QianmiOpen/dubbo-node-client">QianmiOpen/dubbo-node-client</a></p>
<p><strong>另一个node-dubbo客户端：</strong></p>
<p><a href="https://github.com/hufeng/node-jsonrpc-dubbo">node-jsonrpc-dubbo</a>使用json-rpc协议，使node可以调用dubbo的服务</p>
<pre><code class="language-javascript">var client = require('./dubbo-client');


var provider = 'com.ofpay.demo.api.UserProvider';

//简单的调用一个接口
client.getProvider(provider, function(err, userProvider) {
  err
    ? console.log(err)
    : userProvider.queryAll(function(err, data) {console.log(err, data);});
});

//group version support
client.getProvider(provider, 'test1', '2.1', function (err, userProvider) {
  err
    ? console.log(err)
    : userProvider.queryAll(function(err, data) {console.log(err, data);});
});
</code></pre>
<h3>Hessian</h3>
<p><a href="http://shiyanjun.cn/archives/349.html">基于Dubbo的Hessian协议实现远程调用</a>
[nodejs zookeper 客户端 通过hessian 与dubbo交互](</p>
<p>https://github.com/xuyan2680/node-java)</p>
<h2>2. dubbo+vert.x-web</h2>
<p><a href="http://vertx.io/docs/vertx-web/java/">Vert.x-Web</a></p>
<h2>3. dubbo+servlet</h2>
<h2>4. dubbo+ratpack</h2>
<p>Ratpack is a set of Java libraries that facilitate fast, efficient, evolvable and well tested HTTP applications.</p>
<p>It is built on the highly performant and efficient Netty event-driven networking engine.</p>
<p>Ratpack focuses on allowing HTTP applications to be efficient, modular, adaptive to new requirements and technologies, and well-tested over time.</p>
<p>Ratpack可以使用Groovy和Java，运行与JVM上，调用dubbo服务很方便。</p>
<p>Ratpack的问题是服务器集群方案、负载均衡等没有现成案例。</p>
<h2>5. dubbo+python/php</h2>
<p>可以通过Hessian协议来调用。</p>
<ul>
<li><a href="http://blog.51cto.com/jamesfancy/2058830">前后端分离实践有感-边城客栈 学海无涯-51CTO 博客</a></li>
<li><a href="https://www.go2live.cn/dev/%E5%BD%93java%E9%81%87%E5%88%B0jade-%E7%A5%A8%E7%89%9Bpc%E7%89%88%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E7%9A%84%E5%AE%9E%E8%B7%B5-%E6%BC%94%E9%81%93%E7%BD%91.html">当 Java 遇到 Jade&mdash;票牛 PC 版前后端分离的实践-演道网 | 演道网</a></li>
</ul>