<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
<link rel="stylesheet" href="../theme/css/my.css" /><h2>What:</h2>
<p>XSS（cross-site script）跨站脚本是由于web应用程序对用户的输入过滤不严而产生的。攻击者利用网站漏洞把恶意的脚本代码注入到网页中，当其他用户浏览这些网页时，就会执行其中的恶意代码，对受害用户可能采用cookie资料窃取，会话劫持，钓鱼欺骗等攻击手段。</p>
<p>如：</p>
<pre><code class="language-js">// 使用xss弹出恶意警告框，代码为：

&lt;script&gt;alert(&quot;xss&quot;)&lt;/script&gt;

// xss输入也可能是html代码段，如果使网页不停的刷新，代码为

&lt;meta http-equiv=&quot;refresh&quot; content=&quot;0;&quot;&gt;

// 嵌入其他网站链接的代码为：

&lt;iframe src=http:/liuwx.cn width=0 height=0&gt;&lt;/iframe&gt;

</code></pre>
<h3>XSS分类</h3>
<ul>
<li>
<p>反射型XSS： 非持久化 ， 只执行一次 。如： http://www.liuwx.cn/xss.php?id=<script>alert(1)</script></p>
</li>
<li>
<p>DOM型 XSS：</p>
</li>
<li>
<p>存储型XSS：脚本被上传到Server</p>
</li>
</ul>
<h2>How:</h2>
<h3>如何防范？</h3>
<p>常见的防xss代码：</p>
<pre><code>$x=preg_replace(“/script/”,””,$x);

$x=preg_replace(“/script/i”,””,$x);

$x=preg_replace(“/alert/i”,””,$x);

$x=preg_replace(“/script/i”,””,$x);

</code></pre>
<h3>Java防止XSS</h3>
<p>使用Filter过滤转换浏览器提交的内容。可以使用Spring的工具类：HtmlUtils.htmlEscape，或者commons-lang提供的StringEscapeUtils.escapeHtml。例如：</p>
<pre><code class="language-java">public class XSSFilter implements Filter {

    @Override

    public void init(FilterConfig filterConfig) throws ServletException {

    }

    @Override

    public void destroy() {

    }

    @Override

    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)

        throws IOException, ServletException {

        chain.doFilter(new XSSRequestWrapper((HttpServletRequest) request), response);

    }

}



public class XSSRequestWrapper extends HttpServletRequestWrapper {



    public XSSRequestWrapper(HttpServletRequest servletRequest) {

        super(servletRequest);

    }



    @Override

    public String[] getParameterValues(String parameter) {

        String[] values = super.getParameterValues(parameter);

        if (values == null) {

            return null;

        }

        int count = values.length;

        String[] encodedValues = new String[count];

        for (int i = 0; i &lt; count; i++) {

            encodedValues[i] = stripXSS(values[i]);

        }

        return encodedValues;

    }



    @Override

    public String getParameter(String parameter) {

        String value = super.getParameter(parameter);

        return stripXSS(value);

    }



    @Override

    public String getHeader(String name) {

        String value = super.getHeader(name);

        return stripXSS(value);

    }



    private String stripXSS(String value) {

        return HtmlUtils.htmlEscape(value);

    }

}

</code></pre>
<h2>参考</h2>
<p><a href="https://zhuanlan.zhihu.com/p/26375200">XSS跨站漏洞详解</a>
<a href="http://itindex.net/detail/55334-java-xss-%E6%94%BB%E5%87%BB">java 防止 XSS 攻击的常用方法总结</a></p>