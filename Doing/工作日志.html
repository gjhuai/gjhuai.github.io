<h1>Golang</h1>
<h2>Go modules使用步骤：</h2>
<p>https://blog.csdn.net/fly910905/article/details/104297446#Go%20modules%E4%BD%BF%E7%94%A8%E6%AD%A5%E9%AA%A4%EF%BC%9A</p>
<p>go mod init
go mod tidy
go mod verify
go mod vendor</p>
<h1>golang如何将interface转为int, string, slice, struct等类型</h1>
<p>http://www.fidding.me/article/99</p>
<h1>Spring Boot</h1>
<ul>
<li>
<p>＠EnableAutoConfiguration
通过＠EnableAutoConfiguration 启用 Spring 应用程序上下文的自动配 ，这个注解会导人一个 EnableAutoConfigurationlmportSelector 的类，而 AutoConfigurationlmportSelector这个类会去读取一个 spring.factories下 key 为 EnableAutoConfiguration 对应的类全限定名的值。</p>
</li>
<li>
<p>exclude 一个AutoConfiguration
在<code>application.properties</code>文件加入下面这行。
<code>spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration</code></p>
</li>
</ul>
<p>或者
<code>@EnableAutoConfiguration(exclude=SecurityAutoConfiguration.class)</code>
@SpringBootApplication 的exclude 不起作用。</p>
<ul>
<li>@EnableConfigurationProperties</li>
</ul>
<h1>Yapi安装启动</h1>
<h2>安装</h2>
<pre><code>mkdir yapi
cd yapi
git clone https://github.com/YMFE/yapi.git vendors //或者下载 zip 包解压到 vendors 目录（clone 整个仓库大概 140+ M，可以通过 `git clone --depth=1 https://github.com/YMFE/yapi.git vendors` 命令减少，大概 10+ M）
cp vendors/config_example.json ./config.json //复制完成后请修改相关配置
cd vendors
npm install --production --registry https://registry.npm.taobao.org
npm run install-server //安装程序会初始化数据库索引和管理员账号，管理员账号名可在 config.json 配置
node server/app.js //启动服务器后，请访问 127.0.0.1:{config.json配置的端口}，初次运行会有个编译的过程，请耐心等候
</code></pre>
<h2>启动</h2>
<p>启动yapi:  /home/dyys/my-yapi/start-yapi.sh</p>
<p>利用pm2方便服务管理维护。</p>
<pre><code class="language-shell">npm install pm2 -g  //安装pm2
cd  {项目目录}
pm2 start &quot;vendors/server/app.js&quot; --name yapi //pm2管理yapi服务
pm2 info yapi //查看服务信息
pm2 stop yapi //停止服务
pm2 restart yapi //重启服务
</code></pre>
<h1>安装gitweb</h1>
<p>参考：
<a href="http://aandds.com/blog/tool-fcgiwrap.html">fcgiwrap和nginx安装</a></p>
<p><a href="https://windard.com/blog/2020/06/26/Linux-Service">Systemctl用法详解</a></p>
<h2>安装和配置fcgiwrap</h2>
<ul>
<li>安装： <code>yum install fcgiwrap</code></li>
<li>启动：<code>systemctl status fcgiwrap.service</code></li>
</ul>
<p>文件 <code>/lib/systemd/system/fcgiwrap.service</code> ：</p>
<pre><code class="language-shell">[Unit]
Description=Simple CGI Server
After=nss-user-lookup.target

[Service]
EnvironmentFile=/etc/sysconfig/fcgiwrap

#ExecStart=/usr/sbin/fcgiwrap ${DAEMON_OPTS} -c ${DAEMON_PROCS}
# 方式一：nohup fcgiwrap -f -c 4 -s unix:/run/fcgiwrap.socket &amp; ：nginx和web服务必须是一台电脑
# 方式二：nohup fcgiwrap -f -c 4 -s tcp:0.0.0.0:9000 &amp; ：两台电脑
# 启动 2 个 fcgiwrap worker 进程
ExecStart=/usr/sbin/fcgiwrap -f -c 2 -s unix:/run/fcgiwrap.socket
# 暂停1秒，等待 /run/fcgiwrap.socket 生成
ExecStartPost=/bin/sleep 1
ExecStartPost=/usr/bin/chown nginx:nginx /run/fcgiwrap.socket

#User=nginx
#Group=nginx

[Install]
#WantedBy=multi-user.target
#Also=fcgiwrap.socket
</code></pre>
<ul>
<li>修改监听套接字文件的 owner：<code>chown nginx:nginx /var/run/fcgiwrap.socket</code>。 fcgiwrap.service文件已经写入，可以省去。</li>
<li>自启动： <code>systemctl enabled fcgiwrap.service</code></li>
</ul>
<h2>安装gitweb</h2>
<p><code>yum install gitweb</code></p>
<p>默认gitweb是安装到apache目录中的，也就是/var/www/git目录下，专门用来显示gitweb页面</p>
<h2>配置nginx</h2>
<pre><code>location /gitweb.cgi {
     root /var/www/git/;
     include fastcgi_params;
     gzip off;
     fastcgi_param SCRIPT_NAME /var/www/git/gitweb.cgi;
     fastcgi_param GITWEB_CONFIG /etc/gitweb.conf;
     fastcgi_pass  unix:/var/run/fcgiwrap.socket;
}

location / {
    root /var/www/git/;
    index gitweb.cgi;
}
</code></pre>
<h2>配置ReviewBoard的Repository</h2>
<p>Raw File URL Mask: http://192.168.31.200:8180/?p=blocks/blocks-components.git;a=blob_plain;f=<filename>;h=<revision></p>
<h1>整合gogs 与 ReviewBoard</h1>
<p>reviewboard 对 gogs 这种第三方的git仓库支持，在添加<code>Repository</code>时，只能通过<code>Raw file URL mask</code>来实现。
<a href="https://github.com/gogs/gogs/issues/4857">Add get blob API #4857</a></p>
<p>错误：
<a href="https://www.mail-archive.com/reviewboard@googlegroups.com/msg20895.html">Re: fatal: Not a git repository: 'None' (HTTP 400, API Error 224)</a></p>
<p>rbtools.api.errors.BadRequestError: fatal: not a git repository: 'None'</p>
<p>示例：
Repository type: Git
Path: http://cddyys.ddns.net:3000/blocks/blocks-components.git
Raw File URL Mask: http://cddyys.ddns.net:3000/blocks/blocks-components/raw/2.0.x/<filename>?id=<revision></p>
<p>git diff --full-index &gt;b.diff</p>
<p>rbt post -p -d --tracking-branch=origin/2.0.x --diff-filename=a.diff --summary=init_blog --description= "complete blog index" --target-people=guanjh</p>
<h1>调试ex-user</h1>
<ul>
<li>注释掉Task.class的@Component，WebDestroyAction.class的@Component</li>
</ul>
<h1>spring容器启动后执行</h1>
<p><a href="https://blog.csdn.net/xiaojin21cen/article/details/83418470">Spring 容器启动完成后，执行初始化加载工作</a></p>
<pre><code class="language-java">@Component
public class InitBeanTest implements ApplicationListener&lt;ContextRefreshedEvent&gt; {
    // 此方法会被多次调用
    @Override
    public void onApplicationEvent(ContextRefreshedEvent event) {
        /**
        在web 项目中，存在两个容器，一个是root application context，另一个就是我们自己的 projectName-servlet context（作为 root application context 的子容器）。
        这种情况下，就会造成 onApplicationEvent 方法被执行两次。
        为了避免上面提到的问题，我们可以只在 root application context 初始化完成后调用逻辑代码
        */
        if(event.getApplicationContext().getParent() == null){//root application context 没有parent
            //TODO 这里写下将要初始化的内容
        }
    } 
}
</code></pre>
<h1>在spring-boot工程环境的junit测试</h1>
<h2>基于纯spring方式</h2>
<p>此方式事务是起作用的。</p>
<pre><code class="language-xml">&lt;context:annotation-config/&gt;

    &lt;context:component-scan base-package=&quot;com.ex&quot;&gt;
        &lt;context:exclude-filter type=&quot;annotation&quot; expression=&quot;org.springframework.stereotype.Controller&quot;/&gt;
        &lt;context:exclude-filter type=&quot;annotation&quot; expression=&quot;org.springframework.web.bind.annotation.RestController&quot;/&gt;
        &lt;context:exclude-filter type=&quot;annotation&quot; expression=&quot;org.springframework.boot.autoconfigure.SpringBootApplication&quot;/&gt;
        &lt;context:exclude-filter type=&quot;annotation&quot; expression=&quot;org.springframework.web.servlet.config.annotation.EnableWebMvc&quot;/&gt;

        &lt;context:exclude-filter type=&quot;assignable&quot; expression=&quot;com.ex.web.aspect.AppSignCheck&quot;/&gt;
        &lt;context:exclude-filter type=&quot;assignable&quot; expression=&quot;com.ex.admin.aspect.AdminPermissionAspect&quot;/&gt;
    &lt;/context:component-scan&gt;

    &lt;bean class=&quot;com.dyys.framework.util.SpringHelper&quot; /&gt;

    &lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;
        &lt;property name=&quot;dataSource&quot; ref=&quot;dsMain&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;

    &lt;tx:annotation-driven transaction-manager=&quot;transactionManager&quot;&gt;&lt;/tx:annotation-driven&gt;

    &lt;!-- DAO接口所在包名，Spring会自动查找其下的类 --&gt;
    &lt;bean name=&quot;mainSqlScannerConfigurer&quot; class=&quot;org.beetl.sql.ext.spring.BeetlSqlScannerConfigurer&quot;&gt;
        &lt;!-- 哪些类可以自动注入 --&gt;
        &lt;property name=&quot;basePackage&quot; value=&quot;com.ex&quot;/&gt;
        &lt;!-- 通过类后缀 来自动注入Dao --&gt;
        &lt;property name=&quot;daoSuffix&quot; value=&quot;Mapper&quot;/&gt;
        &lt;property name=&quot;sqlManagerFactoryBeanName&quot; value=&quot;mainSqlManager&quot;/&gt;
    &lt;/bean&gt;

    &lt;bean id=&quot;mainSqlManager&quot; class=&quot;org.beetl.sql.ext.spring.SqlManagerFactoryBean&quot;&gt;
        &lt;property name=&quot;cs&quot; &gt;
            &lt;bean  class=&quot;org.beetl.sql.ext.spring.SpringConnectionSource&quot;&gt;
                &lt;property name=&quot;masterSource&quot; ref=&quot;dsMain&quot;&gt;&lt;/property&gt;
                &lt;!-- 还可以设置从数据库 slaves --&gt;
            &lt;/bean&gt;
        &lt;/property&gt;
        &lt;property name=&quot;dbStyle&quot;&gt;
            &lt;bean class=&quot;org.beetl.sql.core.db.MySqlStyle&quot;/&gt;
        &lt;/property&gt;
        &lt;property name=&quot;sqlLoader&quot;&gt;
            &lt;bean class=&quot;org.beetl.sql.core.loader.MarkdownClasspathLoader&quot;&gt;
                &lt;property name=&quot;sqlRoot&quot; value=&quot;sql&quot;&gt;&lt;/property&gt;
            &lt;/bean&gt;
        &lt;/property&gt;
        &lt;property name=&quot;nc&quot;&gt;
            &lt;bean class=&quot;org.beetl.sql.core.DefaultNameConversion&quot;/&gt;
        &lt;/property&gt;
        &lt;property name=&quot;interceptors&quot;&gt;
            &lt;list&gt;
                &lt;bean class=&quot;org.beetl.sql.ext.DebugInterceptor&quot;&gt;&lt;/bean&gt;
            &lt;/list&gt;
        &lt;/property&gt;
    &lt;/bean&gt;
</code></pre>
<p>测试用例为</p>
<pre><code class="language-java">@RunWith(SpringRunner.class)
@PropertySource(&quot;classpath:application.properties&quot;)
@ContextConfiguration(locations = {&quot;classpath*:spring-test.xml&quot;})
@EnableAutoConfiguration(exclude= WebMvcAutoConfiguration.class)
public class CoinTest {

    @Autowired
    private CoinService coinService;

    @Test
    public void addCoinAndFinanceAccount(){
        Coin coin = new Coin(&quot;WKKk&quot;, CoinGroup.MAINSTREAM_COIN.value());
        Long adminId = 11L;
        coin = coinService.addCoinAndFinanceAccount(coin, adminId);
        Assert.assertNotNull(coin);
    }

}
</code></pre>
<h2>基于spring-boot方式</h2>
<p>此方式事务不起作用。
重写一个Application类。</p>
<pre><code class="language-java">@SpringBootApplication(exclude= WebMvcAutoConfiguration.class)
@ComponentScan(excludeFilters = {
        @ComponentScan.Filter(type= FilterType.ASSIGNABLE_TYPE, value = {WebApplication.class, AppSignCheck.class,
                AdminPermissionAspect.class}),
        @ComponentScan.Filter(type= FilterType.ANNOTATION, value={EnableWebMvc.class, Controller.class, RestController.class})
})
@EnableTransactionManagement
public class TestApplication {

    public static void main(String[] args) {
        SpringApplication.run(TestApplication.class, args);
    }

    @Bean
    @Order(-100)
    public SpringHelper springHelper(){
        return new SpringHelper();
    }
}
</code></pre>
<p>测试用例为：</p>
<pre><code class="language-java">@RunWith(SpringRunner.class)
@SpringBootTest(classes = TestApplication.class, webEnvironment = SpringBootTest.WebEnvironment.NONE)
@Transactional
public class CoinServiceTest {
    @Autowired
    private CoinService coinService;

    @Test
    public void addCoinAndFinanceAccount(){
        Coin coin = new Coin(&quot;WKKk&quot;, CoinGroup.MAINSTREAM_COIN.value());
        Long adminId = 11L;
        coin = coinService.addCoinAndFinanceAccount(coin, adminId);
        Assert.assertNotNull(coin);
    }
}
</code></pre>
<h1>mintty乱码</h1>
<p>在cmder的settings -&gt; 启动 -&gt; 任务 中设置：
<code>mintty -o Locale=zh_CN -o Charset=GBK</code></p>